# 08. 통합점: 게이트웨이, 터널, 릴레이

HTTP는 웹에 있는 모든 리소스에 대한 프로토콜로 사용된다.
여러 종류의 리소스에 접근하고 다른 프로토콜이나 애플리케이션 간 통신에 HTTP가 어떻게 쓰이는지 알아보자.

## 게이트웨이

하나의 어플리케이션으로 복잡한 리소스 모두를 처리하기 힘들어지면서 리소스를 받기 위한 경로를 안내하기 위한 목적으로 고안되었으며 HTTP 트래픽을 다른 프로토콜로 변환하여 HTTP 클라이언트가 다른 프로토콜을 알 필요 없이 서버에 접속할 수 있게 한다.

- FTP URL을 가리키는 `HTTP 요청`을 받아 HTTP로 변환하여 `FTP 서버`에 전달한다.
- 암호화된 웹 요청을 `SSL`으로 받고 인증서를 이용해 요청을 복호화하고 `HTTP` 요청을 서버에 전달한다.
- `서버 게이트웨어 API`를 통해 HTTP 요청을 `애플리케이션`에 전달한다.

### 클라이언트 측 게이트웨이와 서버 측 게이트웨이

웹 게이트웨이는 한쪽에서는 HTTP로 반대쪽에서는 다른 프로토콜로 통신하는데 `<클라이언트 프로토콜>/<서버 프로토콜>` 형식으로 표현한다.

- 서버 측 게이트웨이는 클라이언트와 HTTP로 통신하고 서버와는 다른 프로토콜로 통신한다.
- 클라이언트 측 게이트웨이는 클라이언트와는 다른 프로토콜로 통신하고 서버와 HTTP로 통신한다.

## 프로토콜 게이트웨이

브라우저에 게이트웨이를 설정하거나 게이트웨이를 리버스 프록시로 설정하면 HTTP 요청을 게이트웨이로 보낼 수 있다. 이 경우 일반적인 HTTP 트래픽에는 영향을 주지 않으며 설정된 프로토콜 요청만 게이트웨이에서 처리하게 된다.

### HTTP/\*: 서버 측 웹 게이트웨이

서버 측 웹 게이트웨이는 클라이언트로부터 HTTP 요청이 서버 영역으로 들어오는 시점에 클라이언트 측의 HTTP 요청을 외래 프로토콜로 전환한다.

그림에서는 HTTP를 통해 요청했을시 `HTTP/FTP` 인바운드 변환 게이트웨이에서 FTP서버에게 인증과 요청 정보를 전달하여 해당 데이터를 반환하고, 해당 객체를 받는대로 HTTP응답에 실어서 클라이언트에게 전송한다.

### HTTP/HTTPS: 서버 측 보안 게이트웨이

`HTTP/HTTPS` 게이트웨이를 사용하면 모든 웹 요청을 암호화 하여 전달하여 개인 정보 보호와 보안을 제공할 수 있다.

### HTTPS/HTTP: 클라이언트 측 보안 가속 게이트웨이

웹 서버의 앞단에서 동작하여 보안 가속기 역할을 하는 `HTTPS/HTTP` 게이트웨이가 있다. 해당 게이트웨이는 보이지 않는 `인터셉트 게이트웨이`나 `리버스 프락시` 역할을 하며 효율적으로 보안 트래픽을 복호화 하는 암호화 하드웨어를 내장해서 성능을 높이기도 한다.

게이트웨이와 원 서버간에는 암호화 하지 않은 트래픽을 전송하기 때문에 그 사이의 네트워크가 안전한지 확인 하고 사용 해야 한다.

## 리소스 게이트웨이

게이트웨이의 가장 일반적인 형태인 애플리케이션 서버는 목적지 서버와 게이트웨이를 한개의 서버로 결합한다. 애플리케이션 서버는 HTTP를 통해서 클라이언트와 통신하고 서버 측에 있는 애플리케이션 프로그램에 연결하는 서버 측 게이트웨이다.

어플리케이션 서버는 게이트웨이의 `API`를 통해서 요청을 다른 어플리케이션에 전달하고 결과를 받아서 클라이언트에 전송한다.

서버 게이트웨이 어플리케이션은 URL의 `query string`에 따라 게이트웨이 프로세스를 생성하고 해당되는 응답을 반환한다.

### 공용 게이트웨이 인터페이스

최초의 서버 확장이자 가장 널리 쓰이는 서버 확장으로 웹에서 동적인 HTML, 신용카드처리, 데이터베이스 질의 등을 제공한다.

`CGI` 애플리케이션이 서버와 분리되면서 `펄`, `Tcl`, `C`, `셸` 등 다양한 언어로 구현이 가능하다.

단순하기 때문에 거의 모든 HTTP 서버가 지원하며 성능관련 비용이 발생, 부하가 크고 서버의 성능을 제어, 장비에 부담을 준다. 이 부분을 보완하기 위해 `FastCGI`가 나왔다.

### 서버 확장 API

서버 자체의 동작을 바꾸거나 서버의 처리 능력을 최고치로 끌어올리기 위해 개발된 확장 API로 서버의 동작을 변경 할 수 있게 한다.

FrontPage Server Extensions (FPSE)는 서버 확장 API의 한 예로 FPSE를 사용하면 웹 서버에 다양한 기능을 추가할 수 있으며 폼 처리, 데이터베이스 연동, 동적 콘텐츠 생성 등의 기능을 제공할 수 있다.

## 애플리케이션 인터페이스와 웹 서비스

`웹 서비스`는 서로 다른 플랫폼과 애플리케이션이 통신할 수 있는 방법을 제공한다. 애플리케이션 인터페이스는 자동화된 웹 클라이언트가 서버와 통신하도록 설계된다.

## 터널

`터널`은 HTTP 통신을 지원하지 않는 어플리케이션과 HTTP 통신을 할 수 있게 한다. 예를 들어 HTTPS 통신을 지원하지 않는 프록시 서버가 HTTPS 통신을 지원하는 서버와 통신하려면 HTTPS 터널을 사용할 수 있다.

### CONNECT로 HTTP 터널 커넥션 맺기

HTTP 클라이언트가 HTTPS 터널을 사용하려면 `CONNECT` 메서드를 사용해야 한다. 클라이언트는 `CONNECT` 메서드를 사용해서 HTTPS 터널을 연결하고, 터널을 통해 데이터를 보낼 수 있다.

CONNECT 요청

```
CONNECT www.example.com:443 HTTP/1.1
Host: www.example.com
User-agent: Mozilla/5.0
```

CONNECT 응답

```
HTTP/1.1 200 Connection established
Proxy-agent: ProxyAgent/1.0
```

CONNECT 메서드는 프록시 서버와 HTTPS 연결을 맺고, 클라이언트와 서버 사이에 터널을 만든다. 클라이언트는 이 터널을 통해서 HTTPS 요청을 보낼 수 있다.
